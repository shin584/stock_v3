Read [](file:///c%3A/project/p1/market_logic.py#450-450), lines 450 to 600

Read [](file:///c%3A/project/p1/market_logic.py#100-100), lines 100 to 150

Read [](file:///c%3A/project/p1/market_logic.py#150-150), lines 150 to 200

Read [](file:///c%3A/project/p1/market_logic.py#400-400), lines 400 to 450

현재 적용된 필터링 조건들을 정리해 드립니다.

### 1. 전체 공통 필터 (Global Filters)
모든 순위(1~4순위)에 공통적으로 적용되는 **가장 강력한 필터**입니다.
*   **시가총액**: **1조 원 이상** (대형주 전용)
    *   코드: `if market_cap < 1000000000000: continue`
*   **급등주 제외**: 당일 등락률 **+10% 이상**인 종목 제외
    *   코드: `if row['등락률'] >= 10: continue`
*   **금융투자 매도**: 금융투자가 대량 매도(시총 0.1% 이상)하는데, 메이저(외인+투신+연기금)가 그 물량을 다 받아내지 못하면 제외

### 2. 순위별 세부 조건 (Priority Criteria)

#### **1순위 (빈집털이)**
*   **조건**: 프로그램 매도 + (외국인 or 기관합계 매수) + (투신 or 연기금 매수)
*   **금액 기준**:
    *   메이저(외인/기관계): 시총의 **0.2%** 이상 (최대 300억)
    *   서브(투신/연기금): 시총의 **0.1%** 이상 (최대 100억)

#### **2순위 (정석 주도주)**
*   **조건**: 외국인, 투신, 연기금 **3주체 모두 2일 연속 매수**
*   **금액 기준**: 별도 금액 제한 없음 (연속성만 확인)

#### **3순위 (차선책)**
*   **조건**: 3주체 중 **2곳 이상 3일 연속 매수**
*   **금액 기준**: 1순위 기준의 **50%** 이상
    *   외국인: 시총의 **0.1%** 이상
    *   투신/연기금: 시총의 **0.05%** 이상
    *   (대형주 전용이므로 별도의 최소 금액 하한선은 없음)

#### **4순위 (매집 시작)**
*   **기본 조건**:
    *   **가격**: 최근 20일 고점 대비 **-10% 이상 하락**
    *   **유동성**: 거래대금 50억 이상 OR 거래량 5만 주 이상
*   **패턴 조건 (택 1)**:
    *   A. **외국인**: 3일 연속 매수 & 평균 시총 0.05%↑
    *   B. **연기금**: 10일 중 7일 매수 & 평균 시총 0.03%↑
    *   C. **투신**: 2일 연속 매수 & 전일 대비 2배 급증 & 평균 시총 0.1%↑

### 3. 감점 요인 (Penalty)
*   **20일선 이탈**: -40점 (단, 4순위는 면제)
*   **60일선 이탈**: -20점 (단, 4순위는 면제)

현재 로직은 **"시가총액 1조 이상의 대형주"** 중에서만 위 조건들을 검사하도록 설정되어 있습니다.